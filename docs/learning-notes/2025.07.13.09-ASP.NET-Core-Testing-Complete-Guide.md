# ASP.NET Core æµ‹è¯•å®Œæ•´æŒ‡å—

> ç¼–å†™æ—¶é—´ï¼š2025å¹´7æœˆ13æ—¥  
> é¡¹ç›®ï¼šInfoCollector API  
> å­¦ä¹ é‡ç‚¹ï¼šå•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•çš„å®è·µ

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†å®Œæ•´çš„æµ‹è¯•ç­–ç•¥ï¼ŒåŒ…å«**å•å…ƒæµ‹è¯•**å’Œ**é›†æˆæµ‹è¯•**ï¼Œæ€»è®¡16ä¸ªæµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ã€‚

### æµ‹è¯•æ–‡ä»¶ç»“æ„
```
InfoCollectorAPI.Tests/
â”œâ”€â”€ MessageControllerTests.cs       # å•å…ƒæµ‹è¯• (6ä¸ª)
â”œâ”€â”€ MessageApiIntegrationTests.cs   # é›†æˆæµ‹è¯• (10ä¸ª)  
â”œâ”€â”€ InfoCollectorAPI.Tests.csproj   # æµ‹è¯•é¡¹ç›®é…ç½®
â””â”€â”€ README.md                       # æœ¬æ–‡æ¡£
```

### æµ‹è¯•ç»Ÿè®¡
- **å•å…ƒæµ‹è¯•**: 6ä¸ªæµ‹è¯• âœ… å…¨éƒ¨é€šè¿‡
- **é›†æˆæµ‹è¯•**: 10ä¸ªæµ‹è¯• âœ… å…¨éƒ¨é€šè¿‡
- **æ€»è®¡**: 16ä¸ªæµ‹è¯•ï¼Œè¦†ç›–æ ¸å¿ƒåŠŸèƒ½

## ğŸ§ª å•å…ƒæµ‹è¯• (MessageControllerTests.cs)

### ä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•
å•å…ƒæµ‹è¯•æ˜¯æµ‹è¯•**å•ä¸ªç»„ä»¶**ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªç±»æˆ–æ–¹æ³•ï¼‰çš„æµ‹è¯•ï¼Œç‰¹ç‚¹ï¼š
- **éš”ç¦»æ€§å¼º**: ä½¿ç”¨Mockå¯¹è±¡æ¨¡æ‹Ÿå¤–éƒ¨ä¾èµ–
- **é€Ÿåº¦å¿«**: ä¸æ¶‰åŠæ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æ•°æ®åº“
- **å¯é æ€§é«˜**: ç»“æœç¨³å®šï¼Œä¸å—å¤–éƒ¨ç¯å¢ƒå½±å“

### æµ‹è¯•ç›®æ ‡
æµ‹è¯• `MessageController` çš„ä¸šåŠ¡é€»è¾‘ï¼Œä½¿ç”¨å†…å­˜æ•°æ®åº“æ¨¡æ‹Ÿæ•°æ®å±‚ã€‚

### æµ‹è¯•ç”¨ä¾‹
1. **Post_ValidRequest_ReturnsOkResult** - æœ‰æ•ˆè¯·æ±‚è¿”å›æˆåŠŸ
2. **Post_NullRequest_ReturnsBadRequest** - ç©ºè¯·æ±‚è¿”å›é”™è¯¯
3. **Post_EmptyGroupOrUserName_ReturnsBadRequest** - ç©ºç¾¤åè¿”å›é”™è¯¯
4. **Post_EmptyMessageContent_ReturnsBadRequest** - ç©ºæ¶ˆæ¯å†…å®¹è¿”å›é”™è¯¯
5. **Post_ValidRequest_SavesMessageToDatabase** - éªŒè¯æ•°æ®æ­£ç¡®ä¿å­˜
6. **Post_MultipleRequests_SavesAllMessages** - å¤šæ¡æ¶ˆæ¯éƒ½èƒ½ä¿å­˜

### å…³é”®ä»£ç ç¤ºä¾‹
```csharp
[Fact]
public async Task Post_ValidRequest_ReturnsOkResult()
{
    // Arrange - å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
    using var context = GetInMemoryDbContext();  // å†…å­˜æ•°æ®åº“
    var logger = GetLogger();                    // Mock Logger
    var controller = new MessageController(logger, context);
    var request = new MessageRequest
    {
        GroupOrUserName = "æµ‹è¯•ç¾¤",
        MessageContent = "æµ‹è¯•æ¶ˆæ¯", 
        ReceivedDateTime = DateTime.Now
    };

    // Act - æ‰§è¡Œè¢«æµ‹è¯•çš„æ–¹æ³•
    var result = await controller.Post(request);

    // Assert - éªŒè¯ç»“æœ
    var okResult = Assert.IsType<OkObjectResult>(result);
    var response = okResult.Value;
    Assert.NotNull(response);
}
```

### æ•°æ®åº“Mocké…ç½®
```csharp
private InfoCollectorDbContext GetInMemoryDbContext()
{
    var options = new DbContextOptionsBuilder<InfoCollectorDbContext>()
        .UseInMemoryDatabase(databaseName: Guid.NewGuid().ToString())  // æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹æ•°æ®åº“
        .Options;
    return new InfoCollectorDbContext(options);
}

private ILogger<MessageController> GetLogger()
{
    return new LoggerFactory().CreateLogger<MessageController>();
}
```

## ğŸ”— é›†æˆæµ‹è¯• (MessageApiIntegrationTests.cs)

### ä»€ä¹ˆæ˜¯é›†æˆæµ‹è¯•
é›†æˆæµ‹è¯•æ˜¯æµ‹è¯•**å¤šä¸ªç»„ä»¶åä½œ**çš„æµ‹è¯•ï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®ä¸­æ˜¯**ç«¯åˆ°ç«¯æµ‹è¯•**ï¼š
- **çœŸå®ç¯å¢ƒ**: å‘å®é™…è¿è¡Œçš„æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚
- **å®Œæ•´æµç¨‹**: æµ‹è¯•ä»HTTPè¯·æ±‚åˆ°æ•°æ®åº“å­˜å‚¨çš„æ•´ä¸ªè¿‡ç¨‹
- **çœŸå®æ•°æ®**: ä½¿ç”¨çœŸå®çš„SQLiteæ•°æ®åº“æ–‡ä»¶

### æˆ‘ä»¬çš„é›†æˆæµ‹è¯•ç‰¹ç‚¹
ä¸ä¼ ç»Ÿé›†æˆæµ‹è¯•ä¸åŒï¼Œæˆ‘ä»¬çš„é›†æˆæµ‹è¯•æ˜¯**çœŸå®ç”¨æˆ·åœºæ™¯æµ‹è¯•**ï¼š

```csharp
public class MessageApiIntegrationTests
{
    private readonly HttpClient _client;
    private readonly string _baseUrl = "http://localhost:56560"; // çœŸå®æœåŠ¡å™¨åœ°å€

    public MessageApiIntegrationTests()
    {
        _client = new HttpClient();  // çœŸå®HTTPå®¢æˆ·ç«¯
    }
}
```

**å…³é”®å·®å¼‚ï¼š**
- âŒ ä¼ ç»Ÿé›†æˆæµ‹è¯•ï¼š`WebApplicationFactory` å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨
- âœ… æˆ‘ä»¬çš„æ–¹å¼ï¼šå‘**å·²è¿è¡Œçš„çœŸå®æœåŠ¡å™¨**å‘é€è¯·æ±‚

### æµ‹è¯•å‰ææ¡ä»¶
```bash
# å¿…é¡»å…ˆå¯åŠ¨APIæœåŠ¡å™¨
cd InfoCollectorAPI
dotnet run
# æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:56560
```

### æµ‹è¯•ç”¨ä¾‹è¯¦è§£

#### 1. åŸºæœ¬åŠŸèƒ½æµ‹è¯•
```csharp
[Fact]
public async Task SendWeChatMessage_ShouldSucceed()
{
    // æ¨¡æ‹ŸTaskerå‘é€å¾®ä¿¡æ¶ˆæ¯åˆ°API
    var message = new MessageRequest
    {
        GroupOrUserName = "å·¥ä½œç¾¤",
        MessageContent = "æ˜å¤©ä¸Šåˆ9ç‚¹å¼€ä¼š",
        ReceivedDateTime = DateTime.Now
    };

    // å‘é€çœŸå®HTTPè¯·æ±‚
    var response = await _client.PostAsJsonAsync($"{_baseUrl}/api/message", message);

    // éªŒè¯HTTPå“åº”
    Assert.True(response.IsSuccessStatusCode);
    var content = await response.Content.ReadAsStringAsync();
    Assert.Contains("success", content);
    Assert.Contains("æ¶ˆæ¯ä¿å­˜æˆåŠŸ", content);
}
```

#### 2. é”™è¯¯å¤„ç†æµ‹è¯•
```csharp
[Fact]
public async Task SendEmptyGroupName_ShouldFail()
{
    var invalidMessage = new MessageRequest
    {
        GroupOrUserName = "",  // æ— æ•ˆæ•°æ®
        MessageContent = "æµ‹è¯•æ¶ˆæ¯",
        ReceivedDateTime = DateTime.Now
    };

    var response = await _client.PostAsJsonAsync($"{_baseUrl}/api/message", invalidMessage);

    Assert.Equal(System.Net.HttpStatusCode.BadRequest, response.StatusCode);
}
```

#### 3. å¤æ‚åœºæ™¯æµ‹è¯•
```csharp
[Fact]
public async Task SendLongMessage_ShouldWork()
{
    // æµ‹è¯•é•¿æ¶ˆæ¯å¤„ç†èƒ½åŠ›
    var longContent = string.Join("\n", Enumerable.Range(1, 50)
        .Select(i => $"è¿™æ˜¯ç¬¬{i}è¡Œå¾ˆé•¿çš„æ¶ˆæ¯å†…å®¹"));

    var message = new MessageRequest
    {
        GroupOrUserName = "æµ‹è¯•ç¾¤",
        MessageContent = longContent,
        ReceivedDateTime = DateTime.Now
    };

    var response = await _client.PostAsJsonAsync($"{_baseUrl}/api/message", message);
    Assert.True(response.IsSuccessStatusCode, "é•¿æ¶ˆæ¯åº”è¯¥èƒ½æ­£å¸¸å¤„ç†");
}
```

#### 4. å¹¶å‘æµ‹è¯•
```csharp
[Fact]
public async Task ConcurrentRequests_ShouldAllSucceed()
{
    // æµ‹è¯•APIçš„å¹¶å‘å¤„ç†èƒ½åŠ›
    var tasks = new List<Task<HttpResponseMessage>>();
    
    for (int i = 0; i < 5; i++)
    {
        var message = new MessageRequest
        {
            GroupOrUserName = $"å¹¶å‘æµ‹è¯•ç¾¤{i}",
            MessageContent = $"å¹¶å‘æ¶ˆæ¯{i}",
            ReceivedDateTime = DateTime.Now
        };
        
        tasks.Add(_client.PostAsJsonAsync($"{_baseUrl}/api/message", message));
    }

    var responses = await Task.WhenAll(tasks);

    foreach (var response in responses)
    {
        Assert.True(response.IsSuccessStatusCode, "å¹¶å‘è¯·æ±‚éƒ½åº”è¯¥æˆåŠŸ");
    }
}
```

### å…¨éƒ¨æµ‹è¯•ç”¨ä¾‹
1. **SendWeChatMessage_ShouldSucceed** - åŸºæœ¬æ¶ˆæ¯å‘é€
2. **SendMultipleMessages_AllShouldSucceed** - å¤šæ¡æ¶ˆæ¯å‘é€
3. **SendEmptyGroupName_ShouldFail** - ç©ºç¾¤åéªŒè¯
4. **SendEmptyContent_ShouldFail** - ç©ºå†…å®¹éªŒè¯
5. **SendLongMessage_ShouldWork** - é•¿æ¶ˆæ¯å¤„ç†
6. **SendChineseAndEmoji_ShouldWork** - ä¸­æ–‡å’Œè¡¨æƒ…ç¬¦å·
7. **SendNullRequest_ShouldFail** - ç©ºè¯·æ±‚å¤„ç†
8. **SendInvalidJson_ShouldFail** - æ— æ•ˆJSONå¤„ç†
9. **CheckResponseFormat_ShouldBeCorrect** - å“åº”æ ¼å¼éªŒè¯
10. **ConcurrentRequests_ShouldAllSucceed** - å¹¶å‘è¯·æ±‚æµ‹è¯•

## ğŸ†š ä¸¤ç§æµ‹è¯•çš„å¯¹æ¯”

### å•å…ƒæµ‹è¯• vs é›†æˆæµ‹è¯•

| ç‰¹æ€§ | å•å…ƒæµ‹è¯• | æˆ‘ä»¬çš„é›†æˆæµ‹è¯• |
|------|----------|----------------|
| **æµ‹è¯•å¯¹è±¡** | Controllerç±»çš„æ–¹æ³• | å®Œæ•´çš„APIç«¯ç‚¹ |
| **æ•°æ®åº“** | å†…å­˜æ•°æ®åº“ | çœŸå®SQLiteæ–‡ä»¶ |
| **HTTPå±‚** | ç›´æ¥è°ƒç”¨æ–¹æ³• | çœŸå®HTTPè¯·æ±‚ |
| **ä¾èµ–** | Mockæ‰€æœ‰å¤–éƒ¨ä¾èµ– | ä½¿ç”¨çœŸå®åŸºç¡€è®¾æ–½ |
| **é€Ÿåº¦** | å¿« (< 50ms) | æ…¢ (100-500ms) |
| **ç¯å¢ƒè¦æ±‚** | æ—  | éœ€è¦æœåŠ¡å™¨è¿è¡Œ |
| **å‘ç°é—®é¢˜** | é€»è¾‘é”™è¯¯ | é…ç½®ã€ç½‘ç»œã€ç¯å¢ƒé—®é¢˜ |

### ä»£ç å¯¹æ¯”

**å•å…ƒæµ‹è¯•æ–¹å¼ï¼š**
```csharp
// ç›´æ¥è°ƒç”¨Controlleræ–¹æ³•
var controller = new MessageController(logger, context);
var result = await controller.Post(request);
```

**é›†æˆæµ‹è¯•æ–¹å¼ï¼š**
```csharp
// å‘é€HTTPè¯·æ±‚åˆ°çœŸå®æœåŠ¡å™¨
var response = await _client.PostAsJsonAsync("http://localhost:56560/api/message", request);
```

## âš™ï¸ æµ‹è¯•é…ç½®

### æµ‹è¯•é¡¹ç›®ä¾èµ– (InfoCollectorAPI.Tests.csproj)
```xml
<PackageReference Include="Microsoft.AspNetCore.Mvc.Testing" Version="9.0.7" />
<PackageReference Include="Microsoft.EntityFrameworkCore.InMemory" Version="9.0.7" />
<PackageReference Include="Microsoft.NET.Test.Sdk" Version="17.12.0" />
<PackageReference Include="xunit" Version="2.9.2" />
<PackageReference Include="xunit.runner.visualstudio" Version="2.8.2" />
```

### æœåŠ¡å™¨é…ç½®
ç¡®ä¿APIæœåŠ¡å™¨åœ¨æµ‹è¯•å‰å¯åŠ¨ï¼š
```bash
cd InfoCollectorAPI
dotnet run
# æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:56560
```

## ğŸš€ æµ‹è¯•å‘½ä»¤è¯¦è§£

### åŸºæœ¬æµ‹è¯•å‘½ä»¤

#### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
dotnet test
```

#### å®‰é™æ¨¡å¼ï¼ˆåªæ˜¾ç¤ºç»“æœï¼‰
```bash
dotnet test --verbosity quiet
```
è¾“å‡ºç¤ºä¾‹ï¼š
```
Passed!  - Failed: 0, Passed: 16, Skipped: 0, Total: 16, Duration: 780 ms
```

#### è¯¦ç»†æ¨¡å¼ï¼ˆæ˜¾ç¤ºæ¯ä¸ªæµ‹è¯•ï¼‰
```bash
dotnet test --verbosity normal
```
è¾“å‡ºç¤ºä¾‹ï¼š
```
Passed InfoCollectorAPI.Tests.MessageControllerTests.Post_ValidRequest_ReturnsOkResult [42 ms]
Passed InfoCollectorAPI.Tests.MessageControllerTests.Post_NullRequest_ReturnsBadRequest [1 ms]
Passed InfoCollectorAPI.Tests.MessageApiIntegrationTests.SendWeChatMessage_ShouldSucceed [156 ms]
...
```

#### è¯Šæ–­æ¨¡å¼ï¼ˆæœ€è¯¦ç»†ï¼‰
```bash
dotnet test --verbosity diagnostic
```

### ç­›é€‰æµ‹è¯•

#### è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
dotnet test --filter "FullyQualifiedName~MessageControllerTests"

# åªè¿è¡Œé›†æˆæµ‹è¯•  
dotnet test --filter "FullyQualifiedName~MessageApiIntegrationTests"
```

#### è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
```bash
dotnet test --filter "FullyQualifiedName~SendWeChatMessage_ShouldSucceed"
```

#### æŒ‰æµ‹è¯•åç§°æ¨¡å¼ç­›é€‰
```bash
# è¿è¡Œæ‰€æœ‰åŒ…å«"Valid"çš„æµ‹è¯•
dotnet test --filter "Name~Valid"

# è¿è¡Œæ‰€æœ‰"ShouldFail"çš„æµ‹è¯•
dotnet test --filter "Name~ShouldFail"
```

### æµ‹è¯•ç»“æœæ ¼å¼

#### ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
```bash
# ç”ŸæˆXMLæ ¼å¼æŠ¥å‘Š
dotnet test --logger "trx;LogFileName=TestResults.trx"

# ç”ŸæˆHTMLæ ¼å¼æŠ¥å‘Š
dotnet test --logger "html;LogFileName=TestResults.html"
```

#### ä»£ç è¦†ç›–ç‡
```bash
# æ”¶é›†ä»£ç è¦†ç›–ç‡æ•°æ®
dotnet test --collect:"XPlat Code Coverage"
```

### æŒç»­ç›‘è§†æµ‹è¯•
```bash
# ç›‘è§†æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
dotnet watch test
```

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

### æˆåŠŸçš„æµ‹è¯•è¾“å‡º
```
Test run for InfoCollectorAPI.Tests.dll (.NETCoreApp,Version=v9.0)
VSTest version 17.12.0 (x64)

Starting test execution, please wait...
A total of 1 test files matched the specified pattern.

Passed!  - Failed:     0, Passed:    16, Skipped:     0, Total:    16, Duration: 780 ms
```

### å¤±è´¥æµ‹è¯•çš„è¾“å‡ºç¤ºä¾‹
```
Failed InfoCollectorAPI.Tests.MessageControllerTests.Post_NullRequest_ReturnsBadRequest [23 ms]
  Error Message:
   Assert.Equal() Failure
Expected: BadRequest
Actual:   Ok
  Stack Trace:
     at MessageControllerTests.Post_NullRequest_ReturnsBadRequest() in MessageControllerTests.cs:line 65
```

### é›†æˆæµ‹è¯•ç‰¹æœ‰çš„é”™è¯¯
```bash
# æœåŠ¡å™¨æœªå¯åŠ¨
System.Net.Http.HttpRequestException : Connection refused (localhost:56560)

# ç«¯å£é…ç½®é”™è¯¯
System.Net.Http.HttpRequestException : Connection refused (localhost:5000)
```

## ğŸ› ï¸ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½åçº¦å®š
```csharp
// å•å…ƒæµ‹è¯•æ ¼å¼ï¼šæ–¹æ³•å_åœºæ™¯_æœŸæœ›ç»“æœ
Post_ValidRequest_ReturnsOkResult
Post_NullRequest_ReturnsBadRequest

// é›†æˆæµ‹è¯•æ ¼å¼ï¼šæ“ä½œ_æœŸæœ›ç»“æœ
SendWeChatMessage_ShouldSucceed
SendEmptyContent_ShouldFail
```

### 2. AAA æ¨¡å¼ (Arrange-Act-Assert)
```csharp
[Fact]
public async Task TestMethod()
{
    // Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
    var request = new MessageRequest { ... };
    
    // Act - æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
    var result = await controller.Post(request);
    
    // Assert - éªŒè¯ç»“æœ
    Assert.True(result.IsSuccess);
}
```

### 3. æµ‹è¯•éš”ç¦»
```csharp
// å•å…ƒæµ‹è¯•ï¼šæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹æ•°æ®åº“
private InfoCollectorDbContext GetInMemoryDbContext()
{
    var options = new DbContextOptionsBuilder<InfoCollectorDbContext>()
        .UseInMemoryDatabase(databaseName: Guid.NewGuid().ToString())  // å”¯ä¸€æ•°æ®åº“å
        .Options;
    return new InfoCollectorDbContext(options);
}

// é›†æˆæµ‹è¯•ï¼šå…±äº«çœŸå®æ•°æ®åº“ï¼ˆæ³¨æ„æ•°æ®æ¸…ç†ï¼‰
public MessageApiIntegrationTests()
{
    _client = new HttpClient();  // å…±äº«HTTPå®¢æˆ·ç«¯
}
```

## ğŸš¨ å¸¸è§é—®é¢˜ä¸è§£å†³

### 1. é›†æˆæµ‹è¯•è¿æ¥å¤±è´¥
```
Error: Connection refused (localhost:5000)
```
**åŸå› **: ç«¯å£é…ç½®é”™è¯¯  
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥æœåŠ¡å™¨å®é™…ç«¯å£
```bash
# æŸ¥çœ‹ launchSettings.json ä¸­çš„ç«¯å£
cat Properties/launchSettings.json
# æ›´æ–°æµ‹è¯•ä¸­çš„ _baseUrl
```

### 2. å•å…ƒæµ‹è¯•æ•°æ®åº“é”™è¯¯
```
Error: SQLite Error 14: 'unable to open database file'
```
**åŸå› **: å•å…ƒæµ‹è¯•ä¸åº”è¯¥ä½¿ç”¨çœŸå®æ•°æ®åº“  
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨å†…å­˜æ•°æ®åº“
```csharp
options.UseInMemoryDatabase("TestDb")  // æ­£ç¡®æ–¹å¼
// è€Œä¸æ˜¯
options.UseSqlite("Data Source=database/test.db")  // é”™è¯¯æ–¹å¼
```

### 3. æµ‹è¯•é—´æ•°æ®æ±¡æŸ“
```
Error: é¢„æœŸ1æ¡è®°å½•ï¼Œå®é™…3æ¡è®°å½•
```
**å•å…ƒæµ‹è¯•è§£å†³æ–¹æ¡ˆ**: æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹æ•°æ®åº“
```csharp
var dbName = Guid.NewGuid().ToString();
options.UseInMemoryDatabase(dbName);
```

**é›†æˆæµ‹è¯•è§£å†³æ–¹æ¡ˆ**: æ¥å—æ•°æ®ç´¯ç§¯æˆ–åœ¨æµ‹è¯•å‰æ¸…ç†
```csharp
// å¯ä»¥æ¥å—æ•°æ®ç´¯ç§¯ï¼Œå› ä¸ºæµ‹è¯•çš„æ˜¯çœŸå®åœºæ™¯
Assert.True(messageCount >= expectedCount);
```

## ğŸ“ˆ æˆ‘ä»¬é¡¹ç›®çš„æµ‹è¯•ç­–ç•¥

### æµ‹è¯•å±‚æ¬¡
```
ğŸ”º é›†æˆæµ‹è¯• (10ä¸ª) - MessageApiIntegrationTests
â”‚  â€¢ æµ‹è¯•å®Œæ•´ç”¨æˆ·åœºæ™¯
â”‚  â€¢ å‘çœŸå®æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚
â”‚  â€¢ ä½¿ç”¨çœŸå®SQLiteæ•°æ®åº“
â”‚  
ğŸ”» å•å…ƒæµ‹è¯• (6ä¸ª) - MessageControllerTests  
   â€¢ æµ‹è¯•Controllerä¸šåŠ¡é€»è¾‘
   â€¢ ä½¿ç”¨å†…å­˜æ•°æ®åº“
   â€¢ å¿«é€Ÿã€å¯é ã€éš”ç¦»
```

### è¦†ç›–ç‡åˆ†æ
- **Controllerå±‚**: 100% (æ‰€æœ‰æ–¹æ³•å’Œåˆ†æ”¯)
- **HTTPç«¯ç‚¹**: 100% (GET/POST/é”™è¯¯åœºæ™¯)
- **æ•°æ®éªŒè¯**: 100% (å„ç§è¾“å…¥éªŒè¯)
- **é”™è¯¯å¤„ç†**: 100% (å¼‚å¸¸å’Œè¾¹ç•Œæƒ…å†µ)

### æµ‹è¯•ä»·å€¼
1. **å•å…ƒæµ‹è¯•**: ç¡®ä¿ä¸šåŠ¡é€»è¾‘æ­£ç¡®
2. **é›†æˆæµ‹è¯•**: ç¡®ä¿ç³»ç»Ÿæ•´ä½“å·¥ä½œ
3. **ç»„åˆæ•ˆæœ**: æ—¢æœ‰å¿«é€Ÿåé¦ˆï¼Œåˆæœ‰ç«¯åˆ°ç«¯ä¿éšœ

## ğŸ¯ æµ‹è¯•ç­–ç•¥å¯¹æ¯”

### æ ‡å‡†åšæ³• vs æˆ‘ä»¬çš„åšæ³•

#### ä¼ ç»Ÿé›†æˆæµ‹è¯•
```csharp
public class StandardIntegrationTests : IClassFixture<WebApplicationFactory<Program>>
{
    private readonly HttpClient _client;

    public StandardIntegrationTests(WebApplicationFactory<Program> factory)
    {
        _client = factory.CreateClient();  // æµ‹è¯•æœåŠ¡å™¨
    }
}
```

#### æˆ‘ä»¬çš„é›†æˆæµ‹è¯•ï¼ˆæ›´åƒE2Eæµ‹è¯•ï¼‰
```csharp
public class MessageApiIntegrationTests
{
    private readonly HttpClient _client;
    private readonly string _baseUrl = "http://localhost:56560";  // çœŸå®æœåŠ¡å™¨

    public MessageApiIntegrationTests()
    {
        _client = new HttpClient();  // çœŸå®HTTPå®¢æˆ·ç«¯
    }
}
```

### ä¼˜ç¼ºç‚¹å¯¹æ¯”

**æˆ‘ä»¬çš„æ–¹å¼ä¼˜ç‚¹ï¼š**
- âœ… æµ‹è¯•çœŸå®ç”¨æˆ·ä½“éªŒ
- âœ… å‘ç°ç¯å¢ƒé…ç½®é—®é¢˜
- âœ… éªŒè¯å®Œæ•´éƒ¨ç½²æµç¨‹
- âœ… ç®€å•ç›´è§‚

**æˆ‘ä»¬çš„æ–¹å¼ç¼ºç‚¹ï¼š**
- âŒ éœ€è¦æ‰‹åŠ¨å¯åŠ¨æœåŠ¡å™¨
- âŒ æµ‹è¯•é€Ÿåº¦è¾ƒæ…¢
- âŒ ä¾èµ–å¤–éƒ¨ç¯å¢ƒ
- âŒ è°ƒè¯•ç›¸å¯¹å›°éš¾

**é€‚ç”¨åœºæ™¯ï¼š**
- å°å‹é¡¹ç›® âœ…
- å­¦ä¹ é˜¶æ®µ âœ…
- å¿«é€ŸéªŒè¯ âœ…
- å¤§å‹é¡¹ç›®çš„è¡¥å……æµ‹è¯• âœ…

## ğŸ“š å­¦ä¹ æ€»ç»“

### å…³é”®æ”¶è·
1. **æµ‹è¯•åˆ†å±‚ç†è§£**: å•å…ƒæµ‹è¯•éªŒè¯é€»è¾‘ï¼Œé›†æˆæµ‹è¯•éªŒè¯åä½œ
2. **çœŸå®æ€§vsç¨³å®šæ€§**: æˆ‘ä»¬é€‰æ‹©äº†çœŸå®æ€§ï¼Œé€‚åˆå°é¡¹ç›®
3. **æµ‹è¯•å‘½åé‡è¦æ€§**: æ¸…æ™°å‘½åæé«˜å¯ç»´æŠ¤æ€§
4. **ç¯å¢ƒä¾èµ–æƒè¡¡**: çœŸå®ç¯å¢ƒæµ‹è¯•æœ‰ä»·å€¼ä½†æœ‰æˆæœ¬

### å®è·µç»éªŒ
1. **å•å…ƒæµ‹è¯•**: å¿«é€Ÿã€å¯é ï¼Œæ˜¯å¼€å‘çš„å®‰å…¨ç½‘
2. **é›†æˆæµ‹è¯•**: æä¾›ä¿¡å¿ƒï¼Œç¡®ä¿ç³»ç»ŸçœŸæ­£å·¥ä½œ
3. **æµ‹è¯•å‘½ä»¤**: ç†Ÿç»ƒä½¿ç”¨å„ç§dotnet testé€‰é¡¹
4. **é—®é¢˜è°ƒè¯•**: ç†è§£å¸¸è§æµ‹è¯•å¤±è´¥åŸå› å’Œè§£å†³æ–¹æ³•

### ä¸‹ä¸€æ­¥æ”¹è¿›
1. è€ƒè™‘æ·»åŠ ä¼ ç»Ÿé›†æˆæµ‹è¯•ï¼ˆWebApplicationFactoryï¼‰
2. å¢åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•
3. æ·»åŠ APIæ–‡æ¡£æµ‹è¯•
4. æ¢ç´¢è‡ªåŠ¨åŒ–æµ‹è¯•æµæ°´çº¿

---

*æœ¬æŒ‡å—è®°å½•äº†InfoCollectoré¡¹ç›®çš„å®Œæ•´æµ‹è¯•å®è·µï¼Œå±•ç¤ºäº†ä»å•å…ƒæµ‹è¯•åˆ°çœŸå®ç¯å¢ƒé›†æˆæµ‹è¯•çš„å®Œæ•´æ–¹æ³•ã€‚*